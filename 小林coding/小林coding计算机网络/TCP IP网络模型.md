# TCP/IP协议栈

## 简单介绍

- 同一个设备的不同进程间进行通信，可以使用管道、消息队列、共享内存、信号等方式完成，而不同设备的进程之间要进行通信，就需要借助网络和网络通信协议来完成。

- TCP/IP协议栈就包含了一套通用的网络通信协议，使用TCP/IP协议栈就能实现网络通信，另外，这个网络通信协议是分层的，每一层都有各自的作用和职责。

## 层次介绍

### 应用层

1. 作用：使用不同的协议将应用进程要传输的数据封装成消息/报文。

2. 使用的协议：HTTP，DNS，SMTP，FTP等。

   3. 应用层工作在操作系统中的用户态，传输层及以下则工作在内核态。

### 传输层

1. 作用：作为应用间传输数据的媒介，帮助实现应用到应用的通信。TCP协议会将应用层传输过来的数据包封装成段。

2. 使用的协议：TCP和UDP
   
   - TCP协议能够进行流量控制、超时重传、拥塞控制等，这些都是为了保证数据包能可靠地传输给对方。
   
   - UDP 相对来说就很简单，简单到只负责发送数据包，不保证数据包是否能抵达对方，正因为简单，所以它的实时性相对更好，传输效率也高。当然，UDP 也可以实现可靠传输，把 TCP 的特性在应用层上实现就可以，不过要实现一个商用的可靠 UDP 传输协议，也不是一件简单的事情。

3. 每个应用进程都有自己的端口号，传输层封装的数据包也会携带端口号，传输层通过端口号来确定数据包应该交给哪个应用进程。

4. 应用层传过来的数据包可能会很大，而传输层传输的数据大小也是有上限的，所以一旦应用层数据包的大小超过MSS，就会在传输层进行分割来保证传输的数据大小不超过MSS，这样即使中途有一个分块丢失或损坏了，只需要重新发送这一个分块，而不用重新发送整个应用层数据包。

### 网络层

1. 作用：保证源设备的数据能到达目的设备，说得更清楚一点就是确定目的设备以及选择到达目的设备传输路径。

2. 网络层最常使用的是 IP 协议，IP 协议会将传输层的发过来的数据包作为数据部分，再加上 IP 包头组装成 IP 报文，如果 IP 报文大小超过 MTU（最大传输单元，即网络层封装的数据包大小，以太网中一般为 1500 字节）就会**再次进行分片**，得到一个可以发送到网络的 IP 报文。

3. 使用IP地址标识网络上的各个设备。
   
   - IP地址有两个作用：作为**网络号**标识子网，作为**主机号**标识同一「子网」下的不同主机，这样根据IP地址寻找目标设备的过程一定是先找到目标设备所在的网络，然后再从该网络中寻找目标设备。
   
   - 如何算出IP地址的网络号和主机号？使用子网掩码
     
     求IP地址的网络号：
     
     <img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IP/16.jpg" title="" alt="img" width="354">
     
     求IP地址的主机号：将子网掩码取反后与IP地址进行进行**按位与运算**，就可以得到主机号。
   
   <img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4/%E7%BD%91%E7%BB%9C/%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E8%AE%A1%E7%AE%97%E5%99%A8.png" title="" alt="子网掩码计算器" width="340">

### 网络接口层（真正地传输数据）

1. 网络接口层负责链路上的数据传输，即直接相连的设备间的数据传输，网络接口层在 IP 头部的前面加上 MAC 头部，并封装成数据帧发送到网络上，MAC头部包含了接收方和发送方的 MAC 地址等信息，我们可以通过 ARP 协议获取对方的 MAC 地址。

2. 为啥要使用MAC地址？因为数据要真正的传输是需要借助物理硬件（网卡）来收发数据的，而MAC地址正是用来标识网卡之类的物理硬件的，以便区分局域网内各个网卡。

---

应用层的数据包-->传输层的数据包-->网络层的数据包-->网络接口层的数据包

![](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E8%BF%87%E7%A8%8B/12.jpg)

---

![](C:\Users\唐飞龙\AppData\Roaming\marktext\images\2023-10-11-21-04-34-image.png)
